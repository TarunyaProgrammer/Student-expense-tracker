<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budgettt - Student Money Tracker</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#121212" />
    <style>
      #global-error {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #121212;
        color: white;
        z-index: 99999;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-family: sans-serif;
        padding: 20px;
      }
      #global-error button {
        margin-top: 20px;
        padding: 10px 20px;
        background: #bb86fc;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="global-error">
      <h2>Something went wrong üòï</h2>
      <p>We encountered an unexpected issue.</p>
      <p
        id="error-details"
        style="color: #cf6679; font-size: 0.8rem; margin-top: 10px"
      ></p>
      <button onclick="hardReset()">Reset & Reload</button>
    </div>

    <script>
      // Global Error Boundary
      window.addEventListener("error", function (event) {
        showError(event.message);
      });
      window.addEventListener("unhandledrejection", function (event) {
        showError(event.reason);
      });

      function showError(msg) {
        const el = document.getElementById("global-error");
        const details = document.getElementById("error-details");
        if (el && details) {
          el.style.display = "flex";
          details.textContent = msg || "Unknown Error";
        }
        console.error(msg);
      }

      function hardReset() {
        if (navigator.serviceWorker) {
          navigator.serviceWorker
            .getRegistrations()
            .then(function (registrations) {
              for (let registration of registrations) {
                registration.unregister();
              }
              window.location.reload(true);
            });
        } else {
          window.location.reload(true);
        }
      }
    </script>

    <!-- AUTH SECTION -->
    <section id="auth-view" class="view">
      <div class="auth-container">
        <h1>Budgettt</h1>
        <p>Privacy-First Money Tracker</p>

        <div id="auth-forms">
          <form id="login-form">
            <input
              type="email"
              id="login-email"
              placeholder="Email"
              required
              autocomplete="email"
            />
            <input
              type="password"
              id="login-pass"
              placeholder="Password"
              required
              autocomplete="current-password"
            />
            <button type="submit" class="btn-primary">Login</button>
          </form>

          <p class="auth-switch">
            Or <a href="#" id="show-signup">Create Account</a>
          </p>
          <button id="skip-login" class="btn-secondary">
            Skip / Offline Mode
          </button>
        </div>

        <div id="signup-forms" class="hidden">
          <form id="signup-form">
            <input
              type="email"
              id="signup-email"
              placeholder="Email"
              required
              autocomplete="email"
            />
            <input
              type="password"
              id="signup-pass"
              placeholder="Password"
              required
              autocomplete="new-password"
            />
            <button type="submit" class="btn-primary">Sign Up</button>
          </form>
          <p class="auth-switch">Or <a href="#" id="show-login">Login</a></p>
        </div>

        <div id="auth-message" class="error-msg"></div>
      </div>
    </section>

    <!-- DASHBOARD SECTION -->
    <section id="dashboard-view" class="view hidden">
      <header>
        <div class="logo">
          Budgettt <span id="sync-status" class="badge">Offline</span>
        </div>
        <div class="actions">
          <button id="sync-btn" class="icon-btn" title="Sync">üîÑ</button>
          <button id="export-btn" class="icon-btn" title="Export">‚¨áÔ∏è</button>
          <button id="logout-btn" class="icon-btn" title="Logout">üö™</button>
        </div>
      </header>

      <!-- SUMMARY CARD -->
      <div class="summary-card">
        <div class="total-balance">
          <span class="label">Net Balance</span>
          <span class="amount" id="net-balance">‚Çπ0.00</span>
        </div>
        <div class="stats-row">
          <div class="stat income">
            <span class="label">Incoming</span>
            <span class="val" id="total-income">‚Çπ0.00</span>
          </div>
          <div class="stat expense">
            <span class="label">Outgoing</span>
            <span class="val" id="total-expense">‚Çπ0.00</span>
          </div>
        </div>
      </div>

      <!-- QUICK ADD FORM -->
      <div class="add-form-container">
        <form id="add-txn-form">
          <div class="amount-row">
            <div class="toggle-group">
              <input
                type="radio"
                name="type"
                id="type-expense"
                value="expense"
                checked
              />
              <label for="type-expense" class="toggle-btn expense">OUT</label>

              <input type="radio" name="type" id="type-income" value="income" />
              <label for="type-income" class="toggle-btn income">IN</label>
            </div>
            <input
              type="number"
              id="amount-input"
              placeholder="0"
              min="0"
              step="any"
              required
              inputmode="decimal"
            />
          </div>

          <div class="details-row">
            <select id="category-input" required>
              <option value="food">üçî Food</option>
              <option value="essentials">üß¥ Essentials</option>
              <option value="clothes">üëï Clothes</option>
              <option value="fun">üéâ Fun</option>
              <option value="others" selected>üì¶ Others</option>
            </select>
            <input type="text" id="note-input" placeholder="Note (optional)" />
            <button type="submit" class="btn-submit">Add</button>
          </div>
        </form>
      </div>

      <!-- FILTERS -->
      <div class="filters">
        <button class="filter-chip active" data-filter="all">All</button>
        <button class="filter-chip" data-filter="food">Food</button>
        <button class="filter-chip" data-filter="fun">Fun</button>
      </div>

      <!-- TRANSACTION LIST -->
      <div id="txn-list" class="txn-list">
        <!-- Transactions injected here -->
        <div class="empty-state">No transactions yet.</div>
      </div>
    </section>

    <script type="module" src="app.js"></script>
  </body>
</html>
